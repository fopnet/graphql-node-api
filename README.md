# Backend Programming challenge - GRAPH NODE API

## ## Demonstration

https://youtu.be/hIGMT0mIWdw

## Database migrations steps

-- DDL

1. create database orbita_development;

2. Create table command
   CREATE TABLE IF NOT EXISTS `users` (
   `id` INTEGER NOT NULL auto_increment ,
   `name` VARCHAR(128) NOT NULL,
   `email` VARCHAR(128) NOT NULL UNIQUE,
   `password` VARCHAR(128) NOT NULL,
   `state` CHAR(2) DEFAULT NULL,
   `createdAt` DATETIME NOT NULL,
   `updatedAt` DATETIME NOT NULL, UNIQUE `users_email_unique` (`email`),
   PRIMARY KEY (`id`)) ENGINE=InnoDB;

3. Forcing add new date type column to installation_date
   CREATE TABLE IF NOT EXISTS panels (
   `id` INTEGER NOT NULL auto_increment ,
   data_provider VARCHAR(200) NOT NULL,
   installation_date VARCHAR(8) NOT NULL,
   iinstallation_date date NULL,
   system_size FLOAT NOT NULL,
   zip_code VARCHAR(8) NOT NULL,
   state VARCHAR(2) NOT NULL,
   cost FLOAT NOT NULL,
   PRIMARY KEY (`id`)
   );

4. Import all data in 2 files generated by JSON data file
   source ~/Downloads/parte1.sql
   source ~/Downloads/parte2.sql

5. Converting varchar installation_date to date type
   update panels p set p.iinstallation_date = STR_TO_DATE(p.installation_date,"%m/%d/%y");

6. Drop varchar installation_date
   alter table panels drop column installation_date;

7. Renaming new iinstallation_date to installation_date
   alter table panels change COLUMN iinstallation_date installation_date date not null;

## Startup Instructions

1. Watch all source changes files, and compile in runtime using nodeon.

   npm run gulp

2. running project
   npm run dev

## Charts Queries

1.  -- amount by state
    select p.state, count(\*)
    from panels p
    where p.state = "NY"
    group by 1
    order by 2 desc
    LIMIT 3;

2.  Installations Cost by state
    select p.cost, p.zip_code, p.data_provider
    from panels p
    where p.state = "NY"
    group by 1,2,3
    order by 1 desc
    LIMIT 3;

3.  Top 3 Installations By Month/Year
    select concat(MONTH(p.installation_date), "/", YEAR(p.installation_date)) as date, count(\*)  
    from panels p where p.state = "TX"
    group by 1
    order by 2 desc
    LIMIT 3;

4.  Top 3 Installations By Month

    SELECT concat(MONTH(installation_date) , '/', YEAR(installation_date)) AS `month`, count(`id`) AS `amount`
    FROM `panels` AS `Panel`
    WHERE `Panel`.`state` = 'TX'
    GROUP BY `month`
    ORDER BY 2 DESC
    LIMIT 3;

## Requisitos obrigatórios

- ✅ Implementar API utilizando RESTful ou GraphQL
- ✅ Utilizar Node.js para implementação da API utilizando o framework de sua preferência. Alguns exemplos: [Express.js](https://expressjs.com/), [NestJS](https://nestjs.com) e [Koa](https://koajs.com)
- ✅ A API deve retornar os dados apenas para usuário logados
- ✅ Padronização do código: seguir algum styleguide de JavaScript e CSS. Se preferir utilize o [Prettier](https://prettier.io/)
- ✅ Utilizar o conjunto de dados por completo
- ✅ (Mysql) Persistir os dados utilizando um banco de dados relacional. Exemplos: [PostgreSQL](https://www.postgresql.org) e [MySQL](https://www.mysql.com)

## Bônus

- ✅ Implementar testes

  ![Cobertura de testes look](https://github.com/fopnet/graphql-node-api/tree/master/coverage/coverage.png "Cobertura de testes")

- ✅ Utilizar TypeScript
