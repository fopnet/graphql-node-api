
--- installing sequelize
npm i -g sequelize-cli@3.0.0

-- listing globals libs 
npm ls -g --depth=0

-- config using sequelize in the root project folder 
sequelize init:config --config  src/config/config.json

-- compile ts to js and deploy in dist folder 
-- run the ser as dev mode using de nodeon to watch the changes
npm run dev

=========== Orbita Challenge Project
1. run project
npm run start

=========== GRAPH NODE API
1. Watch all source changes files, and compile in runtime
npm run gulp

2. running project
 npm run dev



=========== SQL COMMANDS 
SHOW INDEX FROM `users` FROM `orbita_development`;
show global variables like 'max_all%';
SHOW COLUMNS FROM panels	

-- DML
drop table panels;
truncate table panels;
select * from panels;

// default 67108864
SET GLOBAL max_allowed_packet=200000000;

-- DDL  
1. create database orbita_development;

2. drop  table users 

3.
CREATE TABLE IF NOT EXISTS `users` (
    `id` INTEGER NOT NULL auto_increment , 
    `name` VARCHAR(128) NOT NULL, 
    `email` VARCHAR(128) NOT NULL UNIQUE, 
    `password` VARCHAR(128) NOT NULL, 
    `state` CHAR(2) DEFAULT NULL, 
    `createdAt` DATETIME NOT NULL, 
    `updatedAt` DATETIME NOT NULL, UNIQUE `users_email_unique` (`email`), 
    PRIMARY KEY (`id`)) ENGINE=InnoDB;

4.
// forcing add new date type column to installation_date 
CREATE TABLE IF NOT EXISTS panels (
    `id` INTEGER NOT NULL auto_increment ,
    data_provider VARCHAR(200) NOT NULL,
    installation_date VARCHAR(8) NOT NULL,
    iinstallation_date date  NULL,
    system_size FLOAT NOT NULL,
    zip_code VARCHAR(8) NOT NULL,
    state VARCHAR(2) NOT NULL,
    cost FLOAT NOT NULL,
    PRIMARY KEY (`id`)
);

5. Import all data in 2 files        	
source ~/Downloads/parte1.sql
source ~/Downloads/parte2.sql

6. Converting varchar installation_date to date type
update panels p set p.iinstallation_date =  STR_TO_DATE(p.installation_date,"%m/%d/%y");

7. Drop varchar installation_date
alter table panels drop column installation_date;

8. Renaming new iinstallation_date to installation_date
alter table panels change COLUMN  iinstallation_date installation_date date not null;

=================== Charts Queries
 1. -- amount by state
 select  p.state, count(*)
 from panels p 
 where p.state =  "NY" 
 group by 1
 order by 2 desc 
 LIMIT 3;

 -- most cost
2. select  p.cost, p.zip_code, p.data_provider
 from panels p 
 where p.state =  "NY" 
 group by 1,2,3
 order by 1 desc 
 LIMIT 3;

 3. -- most installations
 select concat(MONTH(p.installation_date),  "/",  YEAR(p.installation_date)) as date, count(*)  
 from panels p where p.state =  "TX" 
 group by 1 
 order by 2 desc 
 LIMIT 3;

=============== Demonstration 

https://youtu.be/hIGMT0mIWdw
 

